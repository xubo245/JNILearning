JNI学习14之Mac下运行jni程序(java调用C++)

1.环境准备
Itellij IDEA
CLion:CLion-2018.2.2.dmg
Java:1.8

2. 创建一个java文件（HelloWorld.java）:

	class HelloWorld {
		static {
			System.loadLibrary("HelloWorld");
		}
		private native void print();	
		public static void main(String args[]) {
		   new HelloWorld().print();	
		}
		
	}

2、使用javac命令编译该java文件，在终端输入"javac HelloWorld.java"。生成HelloWorld.class.


3、使用javah命令生成头文件。在终端输入"javah -jni HelloWorld", 生成HelloWorld.h

HelloWorld.h：

	/* DO NOT EDIT THIS FILE - it is machine generated */
	#include <jni.h>
	/* Header for class HelloWorld */
	
	#ifndef _Included_HelloWorld
	#define _Included_HelloWorld
	#ifdef __cplusplus
	extern "C" {
	#endif
	/*
	 * Class:     HelloWorld
	 * Method:    print
	 * Signature: ()V
	 */
	JNIEXPORT void JNICALL Java_HelloWorld_print
	  (JNIEnv *, jobject);
	
	#ifdef __cplusplus
	}
	#endif
	#endif

4、使用本地方法实现头文件中的方法。  
   需要处理下include：在CMakeLists.txt通过include_directories加入java的h文件，包括include和include/darwin，以及前面生成的h文件路径

   
	   cmake_minimum_required(VERSION 3.12)
	project(test)
	
	set(CMAKE_CXX_STANDARD 14)
	
	add_executable(test main.cpp HelloWorld.cpp)
	
	include_directories(/Library/Java/JavaVirtualMachines/jdk1.8.0_171.jdk/Contents/Home/include)
	include_directories(/Users/xubo/Desktop/xubo/git/c/CCallJava/src/main/java)
	include_directories(/Library/Java/JavaVirtualMachines/jdk1.8.0_171.jdk/Contents/Home/include/darwin)
代码：
   
	HelloWorld.cpp：
	
	#include <jni.h>  
	#include <stdio.h>  
	#include "HelloWorld.h"  
	JNIEXPORT void JNICALL Java_HelloWorld_print  
	  (JNIEnv *env, jobject obj)  
	{  
	        printf("HelloWorld JNI!/n");  
	        return;  
	} 

5.用gcc编译生成so文件:

	 gcc -dynamiclib -I $JAVA_HOME/include -I $JAVA_HOME/include/darwin HelloWorld.cpp -o libHelloWorld.jnilib
需要在本地配置好Java_HOME：

	localhost:test xubo$ vi ~/.bash_profile

加入：

	export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_171.jdk/Contents/

生成了libHelloWorld.jnilib：

	localhost:test xubo$ gcc -dynamiclib -I $JAVA_HOME/include -I $JAVA_HOME/include/darwin HelloWorld.cpp -o libHelloWorld.jnilib
	localhost:test xubo$ ll
	total 80
	-rwxr-xr-x  1 xubo  staff   8.2K Sep  6 12:15 libHelloWorld.jnilib
	-rwxr-xr-x  1 xubo  staff   8.2K Sep  6 12:11 libHelloWorld.so
	-rw-r--r--  1 xubo  staff   377B Sep  6 12:11 HelloWorld.h
	drwxr-xr-x  8 xubo  staff   256B Sep  6 12:03 cmake-build-debug
	-rw-r--r--  1 xubo  staff   396B Sep  6 12:03 CMakeLists.txt
	-rw-r--r--  1 xubo  staff   171B Sep  6 12:02 HelloWorld.cpp
	-rw-r--r--  1 xubo  staff    96B Sep  6 11:18 main.cpp
移动到Java项目：

	localhost:test xubo$  cp libHelloWorld.jnilib /Users/xubo/Desktop/xubo/git/c/CCallJava/src/main/java/

6、运行：

指令：

	java -Djava.library.path=.  HelloWorld

记录：

	localhost:java xubo$ java -Djava.library.path=.  HelloWorld
	HelloWorld JNI!
	localhost:java xubo$ 
	localhost:java xubo$ ll
	total 72
	-rwxr-xr-x  1 xubo  staff   8.2K Sep  6 14:29 libHelloWorld.jnilib
	-rwxr-xr-x  1 xubo  staff   8.2K Sep  6 12:12 libHelloWorld.so
	-rw-r--r--  1 xubo  staff   377B Sep  6 11:51 HelloWorld.h
	-rw-r--r--  1 xubo  staff   442B Sep  6 11:50 HelloWorld.class
	-rw-r--r--  1 xubo  staff   189B Sep  6 11:50 HelloWorld.java
	drwxr-xr-x  3 xubo  staff    96B Sep  6 11:39 com
	localhost:java xubo$ 





