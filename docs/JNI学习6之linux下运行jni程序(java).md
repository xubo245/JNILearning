

1、创建一个java文件（HelloWorld.java）:

	class HelloWorld {
		static {
			System.loadLibrary("HelloWorld");
		}
		private native void print();	
		public static void main(String args[]) {
		   new HelloWorld().print();	
		}
		
	}

2、使用javac命令编译该java文件，在终端输入"javac HelloWorld.java"。生成HelloWorld.class.


3、使用javah命令生成头文件。在终端输入"javah -jni HelloWorld", 生成HelloWorld.h

	hadoop@Mcnode1:~/xubo/tools/JNI/javaJNI/HelloWorld$ ll
	total 20
	drwxrwxr-x 2 hadoop hadoop 4096  6月 22 20:41 ./
	drwxrwxr-x 3 hadoop hadoop 4096  6月 22 20:40 ../
	-rw-rw-r-- 1 hadoop hadoop  442  6月 22 20:41 HelloWorld.class
	-rw-rw-r-- 1 hadoop hadoop  377  6月 22 20:41 HelloWorld.h
	-rw-rw-r-- 1 hadoop hadoop  179  6月 22 20:41 HelloWorld.java

HelloWorld.h：

	/* DO NOT EDIT THIS FILE - it is machine generated */
	#include <jni.h>
	/* Header for class HelloWorld */
	
	#ifndef _Included_HelloWorld
	#define _Included_HelloWorld
	#ifdef __cplusplus
	extern "C" {
	#endif
	/*
	 * Class:     HelloWorld
	 * Method:    print
	 * Signature: ()V
	 */
	JNIEXPORT void JNICALL Java_HelloWorld_print
	  (JNIEnv *, jobject);
	
	#ifdef __cplusplus
	}
	#endif
	#endif

4、使用本地方法实现头文件中的方法。

HelloWorld.c：

#include <jni.h>  
#include <stdio.h>  
#include "HelloWorld.h"  
JNIEXPORT void JNICALL Java_HelloWorld_print  
  (JNIEnv *env, jobject obj)  
{  
        printf("HelloWorld JNI!/n");  
        return;  
} 

5.用gcc编译生成so文件:

	gcc -shared -I $JAVA_HOME/include -I $JAVA_HOME/include/linux -fPIC  HelloWorld.c -o libHelloWorld.so

生成了libHelloWorld.so*：

	hadoop@Mcnode1:~/xubo/tools/JNI/javaJNI/HelloWorld$ ll
	total 32
	drwxrwxr-x 2 hadoop hadoop 4096  6月 22 20:45 ./
	drwxrwxr-x 3 hadoop hadoop 4096  6月 22 20:40 ../
	-rw-rw-r-- 1 hadoop hadoop  208  6月 22 20:42 HelloWorld.c
	-rw-rw-r-- 1 hadoop hadoop  442  6月 22 20:41 HelloWorld.class
	-rw-rw-r-- 1 hadoop hadoop  377  6月 22 20:41 HelloWorld.h
	-rw-rw-r-- 1 hadoop hadoop  179  6月 22 20:41 HelloWorld.java
	-rwxrwxr-x 1 hadoop hadoop 8026  6月 22 20:45 libHelloWorld.so*

6、运行：

指令：

	java -Djava.library.path=.  HelloWorld

记录：

	hadoop@Mcnode1:~/xubo/tools/JNI/javaJNI/HelloWorld$ java -Djava.library.path=.  HelloWorld
	HelloWorld JNI!


遇到的问题：

（1）没有指定so文件：

	hadoop@Mcnode1:~/xubo/tools/JNI/javaJNI/HelloWorld$ java HelloWorld
	Exception in thread "main" java.lang.UnsatisfiedLinkError: no HelloWorld in java.library.path
		at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1886)
		at java.lang.Runtime.loadLibrary0(Runtime.java:849)
		at java.lang.System.loadLibrary(System.java:1088)
		at HelloWorld.<clinit>(HelloWorld.java:3)

解决办法：

	导入so文件：java -Djava.library.path=.  HelloWorld

（2）gcc编译成so文件时没有加 -fPIC

	hadoop@Mcnode1:~/xubo/tools/JNI/javaJNI/HelloWorld$ gcc -shared -I $JAVA_HOME/include -I $JAVA_HOME/include/linux  HelloWorld.c -o libHelloWorld.so
	/usr/bin/ld: /tmp/ccO8x4ik.o: relocation R_X86_64_32 against `.rodata' can not be used when making a shared object; recompile with -fPIC
	/tmp/ccO8x4ik.o: error adding symbols: Bad value
	collect2: error: ld returned 1 exit status

 解决办法：加-fPIC

	gcc -shared -I $JAVA_HOME/include -I $JAVA_HOME/include/linux -fPIC  HelloWorld.c -o libHelloWorld.so


参考：
【1】 http://blog.csdn.net/fengqiaoyebo2008/article/details/6210499